<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xuan.service.mapper.VisitLogMapper">

    <!--统计指定时间范围内的独立访客量（UV）-->
    <select id="countUniqueVisitors" resultType="java.lang.Long">
        SELECT COUNT(DISTINCT ip_address)
        FROM visit_log
        WHERE visit_time BETWEEN #{start} AND #{end}
    </select>

    <!--统计指定时间范围内的总访问量（PV）-->
    <select id="countPageViews" resultType="java.lang.Long">
        SELECT COUNT(*)
        FROM visit_log
        WHERE visit_time BETWEEN #{start} AND #{end}
    </select>

    <!--获取指定时间范围内的访问趋势数据-->
    <select id="getVisitTrend" resultType="com.xuan.entity.vo.monitor.VisitTrendVO">
        SELECT DATE(visit_time) AS visitDate, COUNT(*) AS pv, COUNT(DISTINCT ip_address) AS uv
        FROM visit_log
        WHERE visit_time BETWEEN #{start} AND #{end}
        GROUP BY visitDate
        ORDER BY visitDate
    </select>

    <!--获取热门页面（按访问次数排序）-->
    <select id="getTopPages" resultType="java.util.Map">
        SELECT page_url AS pageUrl, COUNT(*) AS count
        FROM visit_log
        WHERE visit_time BETWEEN #{start} AND #{end}
        AND page_url IS NOT NULL
        GROUP BY page_url
        ORDER BY count DESC
        LIMIT #{limit}
    </select>
</mapper>